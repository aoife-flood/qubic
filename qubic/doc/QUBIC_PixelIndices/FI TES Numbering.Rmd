---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.14.0
  kernelspec:
    display_name: Python 3 (ipykernel)
    language: python
    name: python3
---

```{python}
# %config InlineBackend.figure_format='retina'
from IPython.display import display, HTML
display(HTML("<style>.container { width:95% !important; }</style>"))


import pickle
import healpy as hp
from importlib import reload
import xarray as xr


from qubicpack.utilities import Qubic_DataDir
import qubic

import qubicpack as qp



### Correspondance between QP and QS indices: see "Pixel Indices.Rmd"
def iQS2iQP(indexQS):
    qpnumi, qpasici = qp.pix2tes.pix2tes(indexQS+1)
    return qpnumi+(qpasici-1)*128-1

def iQP2iQS(indexQP):
    QStesnum = qp.pix2tes.tes2pix(indexQP%128+1, indexQP//128+1)
    return QStesnum-1

```

```{python}
basedir = Qubic_DataDir()
print('basedir : ', basedir)
dictfilename = basedir + '/dicts/global_source_oneDet.dict'
d = qubic.qubicdict.qubicDict()
d.read_from_file(dictfilename)
d['config'] = 'FI'
q = qubic.QubicInstrument(d)

### QUBIC Soft location
xQS, yQS = q.detector.center[:,0:2].T

### QUBIC Pack locations (actual orientation the instrument)
xTES = -yQS
yTES = xQS


rc('figure',figsize=(30,30))
rc('font',size=12)

plot(xTES, yTES, 'ks', markerfacecolor='none', ms=43)


dx = -0.0012
dy = 0.0003
for i in range(248):
    indexQubicSoft = i
    indexQubicPack = iQS2iQP(i)
    text(xTES[i]+dx, yTES[i]+1.*dy, 'QS: {0:3d}'.format(indexQubicSoft), color='r', fontsize=10)
    text(xTES[i]+dx, yTES[i]-2.2*dy, 'QP: {0:3d}'.format(indexQubicPack), color='b', fontsize=10)
xlabel('Y_ONAFP [m]')
ylabel('Y_ONAFP [m]')
xlim(-0.053,0.053)
ylim(-0.053,0.053)

title('QUBIC Full Instrument Focal Plane')
```

```{python}

```
